<!DOCTYPE html>
<html lang="en">

<head>
  <title>DAW App</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE-edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="css/style.css">
  <script type="text/javascript" src="js/script.js"></script>
</head>

<body>

  <div class="continer-fluid">
    <div class="row">
      <div style="display: flex; justify-content: center;">
        <input class="form-control" type="text" id="txt" placeholder="Velocidad" style="text-align: center;" />
        <input class="form-control" type="text" id="txts" placeholder="Speed" style="text-align: center;" />
        <!--p id="demo"></p-->
      </div>
    </div>
    <div class="row">
      <div style="display: flex; justify-content: center;">
        
        <input class="form-control" type="text" id="txtdist" placeholder="Distancia" style="text-align: center;" />
        <!--p id="demo"></p-->
      </div>
    </div>
    <div class="row">
      <div style="margin: 1%; padding: 1%; display: flex; justify-content: center;">
        <div class="reloj" id="Horas">00</div>
        <div class="reloj" id="Minutos">:00</div>
        <div class="reloj" id="Segundos">:00</div>
        <div class="reloj" id="Centesimas">:00</div>
      </div>
    </div>
    <div class="row" style="margin: 0; padding: 1%; align-content: center; display: flex; justify-content: center;">
      <div>
        <input type="button" class="btn btn-primary" id="inicio" value="Start &#9658;" onclick="inicio();">
        <input type="button" class="btn btn-primary" id="parar" value="Stop &#8718;" onclick="parar();" disabled>
        <input type="button" class="btn btn-primary" id="continuar" value="Resume &#8634;" onclick="inicio();" disabled>
        <input type="button" class="btn btn-primary" id="reinicio" value="Reset &#8635;" onclick="reinicio();" disabled>
        <input type="button" class="btn btn-primary" id="run" value="Run" >
      </div>
    </div>

    <div class="row" style="margin: 0; padding: 1%; align-content: center; display: flex; justify-content: center;">
      <div>
        <a href="rum.html">Run</a> |

        <input type="button" class="btn btn-primary" id="llamada" value="Ok" onclick="">

        <input class="form-control" type="text" id="speed" placeholder="Speed" style="text-align: center;" />
      </div>
    </div>
  </div>

  <script>
    var x = document.getElementById("demo");
    var long_ini = -5.999097;
    var lat_ini = 37.389094;
    var long_fin = 0;
    var lat_fin = 0;

    var h_ini = new Date().getHours();
    var h_fin = new Date().getHours();
    var m_ini = new Date().getMinutes();
    var m_fin = new Date().getMinutes();
    var s_ini = new Date().getSeconds();
    var s_fin = new Date().getSeconds();


    $(document).ready(function () {
      $("#run").click(function () {

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(starposition, showError);
          //navigator.geolocation.watchPosition(showPosition, showError);
          navigator.geolocation.watchPosition(showPosition, showError);
        } else {
          x.innerHTML = "Geolocation is not supported by this browser.";
        }
      })


      function starposition(position) {
        long_ini = position.coords.longitude;
        lat_ini = position.coords.latitude;

        long_fin = position.coords.longitude;
        lat_fin = position.coords.latitude;
      }

      var con = 0;
      function showPosition(position) {
        con++;
        long_fin = position.coords.longitude;
        lat_fin = position.coords.latitude;

        
        var dist = calcCrow(lat_ini, long_ini, lat_fin, long_fin);
        
        //var dist = calcCrow(lat_ini, long_ini,37.390673,-6.003028);
        //var dist = calcCrow(lat_ini, long_ini,37.393469, -6.003715);
        //var dist = calcCrow(lat_ini, long_ini,37.399367, -5.999810);

        var velocidad = dist / caltiem();
        /*$("#txt").val("Latitude: " + position.coords.latitude +
          " | Longitude: " + position.coords.longitude + " | " + dist.toString()); */

        //$("#txt").val(velocidad.toString() + " Km/h");
        $("#txt").val(" Longitud: " + position.coords.longitude);
        $("#txts").val( "Latitud:" + position.coords.latitude + " "+ con );
        $("#txtdist").val(" Distancia: " + dist+ " -------> Velocidad: "+velocidad);

        //$("#demo").text(h_ini + ":" + m_ini + ":" + s_ini);
      }
      var speedEl = document.getElementById('speed');
      /*navigator.geolocation.watchPosition(function (geodata) {
        var speed = geodata.coords.speed;
        
        if (speed === null || speed === 0) {
          $("#speed").val("You're standing still");
        } else {
          // speed is in metres per second
          speedEl.innerHTML = speed + "Mps";
        }
      }, function () {
        $("#speed").val("Unable to determine speed :-(");
      },
        { enableHighAccuracy: true }
      );*/

      function showError(error) {
        switch (error.code) {
          case error.PERMISSION_DENIED:
            x.innerHTML = "User denied the request for Geolocation."
            break;
          case error.POSITION_UNAVAILABLE:
            x.innerHTML = "Location information is unavailable."
            break;
          case error.TIMEOUT:
            x.innerHTML = "The request to get user location timed out."
            break;
          case error.UNKNOWN_ERROR:
            x.innerHTML = "An unknown error occurred."
            break;
        }
      }

      //This function takes in latitude and longitude of two location and returns the distance between them as the crow flies (in km)
      function calcCrow(lat1, lon1, lat2, lon2) {
        var R = 6371; // km
        var dLat = toRad(lat2 - lat1);
        var dLon = toRad(lon2 - lon1);
        var lat1 = toRad(lat1);
        var lat2 = toRad(lat2);

        var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(lat1) * Math.cos(lat2);
        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        var d = R * c;
        return d;
      }
      // Converts numeric degrees to radians
      function toRad(Value) {
        return Value * Math.PI / 180;
      }


      function caltiem() {
        h_ini = h_fin;
        m_ini = m_fin;
        s_ini = s_fin;
        h_fin = new Date().getHours();
        m_fin = new Date().getMinutes();
        s_fin = new Date().getSeconds();
        return (h_fin - h_ini).toString() + "." + (m_fin - m_ini).toString() + (s_fin - s_ini).toString();
      }
    });






  </script>

</body>